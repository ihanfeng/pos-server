<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>1号生活扫码支付</title>
    <link th:href="@{/css/base.css}" rel="stylesheet"/>
    <link th:href="@{/css/keyboard.css}" rel="stylesheet"/>
    <link th:href="@{/css/pay.css}" rel="stylesheet"/>
    <script th:src="@{/js/zepto.min.js}" type="text/javascript"></script>
    <script th:src="@{/js/keyborad.js}" type="text/javascript"></script>
</head>
<body>
<div class="payTitle clearfix">
    <div class="logoLeft clearfix">
        <span class="logo"></span>
    </div>
    <div class="payTitle-right">
        <p>小吃店</p>
        <p>1号生活pos收银台</p>
    </div>
</div>
<div class="payInput clearfix" onclick="inputshow(this);">
    <div class="money">金额</div>
    <div class="num">
        <textarea class="weui-input" type="number" readonly="readonly" id="money" pattern="[0-9]*"
                  value="weui input error" placeholder="0"></textarea>
    </div>
</div>
<div class="warn clearfix">
    <p>新支付 新零售 新金融</p>
</div>


<script th:inline="javascript">
    var paymentType = [[${paymentType}]];
    $(function () {
        keyBoard({
            type: 'tel',
            self: $('#money'),
            onBtnEvents: {
                '确认付款': pay
            }
        });
        /*点击支付事件*/
        function pay() {
            if ($("#money").val().length == 0 || parseFloat($("#money").val()).toString() == "NaN") {
                $('.keyboard .pay').css({"background": "#eee", "color": "#666"});
                return false;
            }
            $.ajax({
                type: 'post',
                url: "/pos/order/qr/create_order",
                data: {
                    passportId: [[${passportId}]],
                    paymentType: paymentType,
                    amount: $('#money').val(),
                    openId: [[${openId}]]
                },
                dataType: 'json',
                success: function (data) {
                    if (paymentType == "WEIXIN_JS") {
                        window.location.href = "/pos/payment/wap/wechatPay/" + data.response.sequenceNumber;
                    } else if (paymentType == "ALIPAY") {
                        window.location.href = "/pos/payment/wap/alipay/" + data.response.sequenceNumber;
                    }
                },
                error: function (data) {
                    alert("支付失败！");
                }
            });
        }

    });

    /*点击金额弹出弹窗*/
    function inputshow() {
        if ($("#money").val().length == 0) {
            $('.keyboard .pay').css({"background": "#eee", "color": "#666"});
        }
        $(".keyboard").show();
    }
</script>
</body>
</html>